name: Deploy to EC2
'on': 
 push:
    branches:
      - main
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2
      - name: executing remote ssh commands using ssh key
        uses: appleboy/ssh-action@v1.0.0
        with:
          host: '${{ secrets.SSH_HOST }}'
          username: '${{ secrets.USER }}'
          key: '${{ secrets.SSH_PRIVATE_KEY }}'
          working-directory: '${{ secrets.WORK_DIR }}'
          timeout: 30s
          script: |
            pwd
            sudo apt-get update
            sudo apt-get install node.js -y
            node -v
            sudo apt-get install npm -y
            npm --version
      - name: Deploy to EC2
        run: |
          cd /home/ubuntu/myrepository/ && git pull origin main
